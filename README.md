# 化学工作站 - 项目文档

## 1. 项目概述

### 1.1 项目简介
化学工作站是一个功能全面的化学辅助应用程序，提供了从单物质分析到AI交互的多种化学相关功能。

### 1.2 项目特点
- 多模块集成：涵盖化学研究的多个领域
- 友好的GUI界面：基于CTkinter开发，支持深色模式
- AI辅助功能：集成多种AI模型，支持流式响应
- 3D可视化：基于VSEPR理论的分子结构可视化
- 实验日志管理：支持自动保存和版本控制
- 网络查询功能：支持学术和化学物质搜索
- 化学符号特殊渲染：支持LaTeX公式和化学符号的正确显示

## 2. 功能模块

### 2.1 单物质分析
- **功能描述**：分析化学式的元素组成和质量百分比
- **主要功能**：
  - 输入化学式，自动解析元素组成
  - 计算总式量和各元素质量百分比
  - 生成元素组成饼图
- **技术实现**：
  - 使用chempy库解析化学式
  - 自定义化学式解析器作为备选方案
  - matplotlib绘制饼图

### 2.2 化学计量 & 设计
- **功能描述**：配平化学方程式并进行相关计算
- **主要功能**：
  - 化学方程式配平
  - 反应物与产物的质量关系计算
  - 反应建议和优化建议
  - 质量关系柱状图
- **技术实现**：
  - chempy库进行化学计量计算
  - matplotlib绘制质量关系图

### 2.3 溶液配制
- **功能描述**：计算溶液配制所需的溶质质量和稀释方案
- **主要功能**：
  - 固体溶质溶液配制计算
  - 溶液稀释计算（M1V1=M2V2）
  - 配制步骤建议
- **技术实现**：
  - 基于化学计量学的浓度计算
  - 详细的配制步骤生成

### 2.4 有机化学
- **功能描述**：有机反应路径预测（演示版）
- **主要功能**：
  - 基于反应物和产物预测反应路径
  - 提供反应中间产物和机理建议
- **技术实现**：
  - 规则引擎匹配常见有机反应
  - 预设反应路径模板

### 2.5 结构化学
- **功能描述**：3D分子结构可视化
- **主要功能**：
  - 基于VSEPR理论的分子结构生成
  - NaCl晶胞模型
  - 交互式3D视图
- **技术实现**：
  - PyVista和PySide6实现3D渲染
  - 预设几何构型库
  - 动态分子构建算法

### 2.6 谱图分析
- **功能描述**：加载和绘制化学谱图数据
- **主要功能**：
  - CSV谱图数据加载
  - 谱图绘制和基本分析
  - 支持多种谱图类型（红外、核磁、质谱等）
- **技术实现**：
  - numpy加载和处理数据
  - matplotlib绘制谱图
  - 自动坐标轴调整

### 2.7 实验日志
- **功能描述**：记录和管理实验日志
- **主要功能**：
  - 实验日志编辑
  - 自动保存和手动保存
  - 版本控制和历史记录
  - 日志导出功能
- **技术实现**：
  - 文件IO操作实现日志存储
  - 版本控制机制
  - 自动保存定时器

### 2.8 网络查询
- **功能描述**：学术和化学物质搜索
- **主要功能**：
  - 学术文献搜索（Google Scholar）
  - 化学物质搜索（PubChem、ChemSpider）
  - 搜索结果导出
- **技术实现**：
  - 搜索引擎工厂模式
  - 模块化设计支持多种搜索引擎
  - 异步搜索机制

### 2.9 AI助手
- **功能描述**：与AI模型交互，支持化学相关查询和分析
- **主要功能**：
  - API配置和密钥管理
  - 提示词模板库
  - AI交互历史记录
  - 化学符号和LaTeX公式渲染
  - 流式AI响应
  - 聊天记录搜索和分类管理
- **技术实现**：
  - 硅基流动API客户端
  - 线程实现AI响应流式输出
  - 正则表达式实现化学符号和LaTeX渲染
  - 分类管理和搜索功能

## 3. 技术架构

### 3.1 整体架构
```
化学家终极工作站
├── 主应用层 (app.py)
│   ├── UI组件
│   └── 业务逻辑
├── 核心模块层 (core/)
│   ├── AI服务 (ai/)
│   ├── 辅助功能 (advisors/)
│   ├── 化学计算器 (calculators/)
│   └── 配置管理 (config.py)
├── API客户端层 (api/)
│   ├── 多种AI服务提供商支持
│   └── 搜索服务客户端
├── 工具模块层 (utils/)
│   ├── 化学工具 (chem_utils/)
│   ├── 文件IO (file_io/)
│   └── 网络工具 (network/)
└── 测试模块层 (tests/)
    └── 单元测试和集成测试
```

### 3.2 核心技术栈
- **GUI框架**：CTkinter
- **3D可视化**：PyVista、PySide6
- **化学计算**：chempy
- **数据处理**：numpy
- **图表绘制**：matplotlib
- **AI集成**：硅基流动API
- **网络请求**：requests
- **日志管理**：自定义日志系统

### 3.3 关键设计模式
- **工厂模式**：API客户端工厂、搜索引擎工厂
- **单例模式**：配置管理器
- **观察者模式**：日志自动保存机制
- **模板方法模式**：AI交互流程

## 4. 安装与配置

### 4.1 系统要求
- Python 3.8+（推荐Python 3.10）
- Windows 10/11
- 至少4GB RAM
- 支持OpenGL的显卡（用于3D可视化）

### 4.2 依赖安装
```bash
# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
venv\Scripts\activate  # Windows

# 安装依赖
pip install -r requirements.txt
```

### 4.3 主要依赖说明
| 依赖库 | 版本要求 | 用途 |
|-------|----------|------|
| customtkinter | 最新 | GUI框架 |
| matplotlib | 最新 | 图表绘制 |
| numpy | 最新 | 数据处理 |
| requests | 最新 | 网络请求 |
| chempy | 最新 | 化学计算 |
| pyvista | 最新 | 3D可视化 |
| PySide6 | 最新 | 3D可视化界面 |

## 5. 使用指南

### 5.1 启动应用程序
```bash
python app.py
```

### 5.2 主要操作流程

#### 5.2.1 单物质分析
1. 在"单物质分析"标签页中输入化学式（如H2O、C6H12O6）
2. 点击"分析物质"按钮
3. 查看元素组成和质量百分比结果
4. 观察生成的元素组成饼图

#### 5.2.2 化学计量计算
1. 在"化学计量 & 设计"标签页中输入化学方程式（如H2 + O2 -> H2O）
2. 点击"配平并计算"按钮
3. 查看配平结果
4. 输入任意物质的质量，查看其他物质的计算结果
5. 观察质量关系柱状图

#### 5.2.3 溶液配制
1. 在"溶液配制"标签页中选择配制类型（固体配制或溶液稀释）
2. 输入相应的参数
3. 点击"计算"按钮
4. 查看配制方案和步骤

#### 5.2.4 3D分子结构可视化
1. 在"结构化学"标签页中输入化学式（如H2O、CH4、NH3）
2. 点击"生成并显示3D模型"按钮
3. 在弹出的3D窗口中查看和旋转分子结构

#### 5.2.5 实验日志管理
1. 在"实验日志"标签页中编辑实验记录
2. 系统会自动保存日志
3. 可手动保存、导出或查看历史版本

#### 5.2.6 AI助手使用
1. 在"AI助手"标签页中配置API密钥
2. 选择或编辑提示词
3. 点击"发送请求"按钮
4. 查看AI响应，支持流式输出
5. 可搜索和分类管理聊天记录

## 6. 开发指南

### 6.1 项目结构
```
chem_assistant/
├── app.py                  # 主应用入口
├── core/                   # 核心模块
│   ├── ai/                 # AI相关功能
│   │   ├── history_manager.py
│   │   ├── prompt_manager.py
│   │   └── silicon_flow_api.py
│   ├── advisors/           # 辅助功能
│   │   └── safety_advisor.py
│   ├── calculators/        # 化学计算器
│   │   └── stoichiometry.py
│   └── config.py           # 配置管理
├── api/                    # API客户端
│   ├── __init__.py
│   ├── api_client.py
│   ├── api_factory.py
│   ├── base_client.py
│   ├── gemini_client.py
│   ├── local_llama_client.py
│   ├── ollama_client.py
│   ├── search_client.py
│   └── siliconflow_client.py
├── utils/                  # 工具模块
│   ├── chem_utils/         # 化学相关工具
│   ├── file_io/            # 文件IO操作
│   │   ├── export_manager.py
│   │   └── journal_manager.py
│   ├── network/            # 网络相关功能
│   │   └── search_engine.py
│   ├── logger.py           # 日志管理
│   └── translator.py       # 翻译功能
├── tests/                  # 测试模块
│   └── test_api_gateway.py
├── logs/                   # 日志文件
├── venv/                   # 虚拟环境
└── README.md               # 项目文档
```

### 6.2 核心模块开发

#### 6.2.1 AI服务扩展
要添加新的AI服务提供商，需要：
1. 在`api/`目录下创建新的客户端类，继承`BaseClient`
2. 实现必要的方法（如`chat_completion`、`chat_completion_stream`）
3. 在`api_factory.py`中注册新的客户端

#### 6.2.2 化学工具扩展
要添加新的化学计算工具，需要：
1. 在`core/calculators/`目录下创建新的计算器类
2. 实现必要的计算方法
3. 在主应用中集成新的计算器

### 6.3 测试
```bash
# 运行单元测试
python -m pytest tests/
```

## 7. 常见问题与解决方案

### 7.1 3D可视化功能不可用
**问题**：点击"生成并显示3D模型"按钮后无反应或报错
**解决方案**：
- 确保已安装PyVista和PySide6依赖
- 检查显卡驱动是否支持OpenGL
- 尝试更新PyVista和PySide6到最新版本

### 7.2 AI助手无法连接API
**问题**：AI请求失败，显示API错误
**解决方案**：
- 检查API密钥是否正确配置
- 确保网络连接正常
- 验证API密钥是否有效
- 检查API服务状态

### 7.3 化学符号显示异常
**问题**：化学式中的数字没有正确显示为下标
**解决方案**：
- 确保字体设置正确，支持Unicode字符
- 检查化学式输入格式是否正确

### 7.4 程序运行缓慢
**问题**：应用程序响应缓慢或卡顿
**解决方案**：
- 关闭不必要的3D可视化窗口
- 减少同时运行的其他程序
- 检查系统资源使用情况

## 8. 未来发展方向

1. **增强AI功能**：
   - 支持更多AI模型和服务提供商
   - 增强化学领域的AI训练和微调
   - 实现更复杂的化学计算和预测

2. **扩展3D可视化**：
   - 支持更多分子结构类型
   - 实现分子动力学模拟
   - 添加更多晶体结构模型

3. **增强化学计算功能**：
   - 添加量子化学计算支持
   - 实现更复杂的反应动力学模拟
   - 增强谱图解析功能

4. **改进用户体验**：
   - 添加更多交互式教程
   - 实现更智能的提示词生成
   - 增强数据导出和共享功能

5. **多平台支持**：
   - 实现跨平台支持（Windows、macOS、Linux）
   - 开发Web版本
   - 实现移动端支持